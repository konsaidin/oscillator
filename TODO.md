# üìã –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞

## –°—Ç–∞—Ç—É—Å: üöß –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

## –§–∏–Ω–∞–ª—å–Ω—ã–π —Å—Ç–µ–∫
- **ESP32-S3** ‚Üí HTTP POST ‚Üí **InfluxDB 2.7** ‚Üí **Grafana 10.x**
- –ë–µ–∑ custom backend ‚Äî Grafana –¥–µ–ª–∞–µ—Ç –≤—Å—ë (–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è + –∞–ª–µ—Ä—Ç—ã + —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)

---

## –≠—Ç–∞–ø 1: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (Docker)
**–°—Ä–æ–∫: 2-3 —á–∞—Å–∞**

- [ ] –°–æ–∑–¥–∞—Ç—å `docker-compose.yml`:
  - [ ] InfluxDB 2.7 (–ø–æ—Ä—Ç 8086)
  - [ ] Grafana 10.x (–ø–æ—Ä—Ç 3000)
  - [ ] Volumes –¥–ª—è –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å InfluxDB:
  - [ ] Organization: `home`
  - [ ] Bucket: `power_monitoring`
  - [ ] Retention Policy: 30 –¥–Ω–µ–π
  - [ ] –°–æ–∑–¥–∞—Ç—å API Token
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å:
  - [ ] http://localhost:8086 (InfluxDB)
  - [ ] http://localhost:3000 (Grafana)

---

## –≠—Ç–∞–ø 2: Firmware ESP32-S3 ‚Äî –ë–∞–∑–æ–≤—ã–π
**–°—Ä–æ–∫: –î–µ–Ω—å 1**

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- [ ] –°–æ–∑–¥–∞—Ç—å `firmware/` –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
- [ ] –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ `platformio.ini`
- [ ] –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É `src/`

### WiFi –∏ HTTP
- [ ] –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WiFi (Station Mode)
- [ ] –†–µ–∞–ª–∏–∑–∞—Ü–∏—è `InfluxClient` –∫–ª–∞—Å—Å–∞:
  - [ ] HTTP POST –Ω–∞ InfluxDB API v2
  - [ ] –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ Line Protocol
  - [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ retry
- [ ] –¢–µ—Å—Ç–æ–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ InfluxDB

---

## –≠—Ç–∞–ø 3: Firmware ‚Äî –°–µ–Ω—Å–æ—Ä—ã –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞
**–°—Ä–æ–∫: –î–µ–Ω—å 1-2**

### ADC –∏ —Å—ç–º–ø–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ ADC1:
  - [ ] GPIO 1, 2, 3
  - [ ] –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ 12 –±–∏—Ç
  - [ ] –ê—Ç—Ç–µ–Ω—é–∞—Ü–∏—è 11dB
- [ ] –ö–ª–∞—Å—Å `VoltageSensor`:
  - [ ] –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ offset –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
  - [ ] –ú–µ—Ç–æ–¥ `readRMS(samples=1000)`
  - [ ] –•—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–ª–∏–±—Ä–æ–≤–æ—á–Ω–æ–≥–æ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞

### –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤
- [ ] –†–∞—Å—á—ë—Ç RMS –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è
- [ ] –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã (Zero-Crossing):
  - [ ] –î–µ—Ç–µ–∫—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ offset
  - [ ] –ò–∑–º–µ—Ä–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –º–µ–∂–¥—É –ø–µ—Ä–µ—Ö–æ–¥–∞–º–∏
  - [ ] –£—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ –∑–∞ 10 –ø–µ—Ä–∏–æ–¥–æ–≤
- [ ] –†–∞—Å—á—ë—Ç –º–µ–∂–¥—É—Ñ–∞–∑–Ω—ã—Ö –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–π (U √ó ‚àö3)
- [ ] –†–∞—Å—á—ë—Ç –ø–µ—Ä–µ–∫–æ—Å–∞ —Ñ–∞–∑ (%)

### –ö–ª–∞—Å—Å `PowerAnalyzer`
- [ ] –ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Å —Ç—Ä—ë—Ö –¥–∞—Ç—á–∏–∫–æ–≤
- [ ] –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ Line Protocol —Å—Ç—Ä–æ–∫–∏
- [ ] –¶–∏–∫–ª –∏–∑–º–µ—Ä–µ–Ω–∏—è –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É

---

## –≠—Ç–∞–ø 4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ESP32 ‚Üí InfluxDB
**–°—Ä–æ–∫: –î–µ–Ω—å 2**

- [ ] –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–∏—Å–∏ –≤ InfluxDB UI (Explore)
- [ ] –ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Å–≤—è–∑–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] LED –∏–Ω–¥–∏–∫–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è:
  - [ ] –ú–∏–≥–∞–µ—Ç ‚Äî –Ω–µ—Ç WiFi
  - [ ] –ì–æ—Ä–∏—Ç ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç
  - [ ] –ù–µ –≥–æ—Ä–∏—Ç ‚Äî –æ—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏

---

## –≠—Ç–∞–ø 5: Grafana ‚Äî Data Source
**–°—Ä–æ–∫: 1-2 —á–∞—Å–∞**

- [ ] –î–æ–±–∞–≤–∏—Ç—å InfluxDB –∫–∞–∫ Data Source:
  - [ ] Query Language: Flux
  - [ ] URL: http://influxdb:8086
  - [ ] Organization: home
  - [ ] Token: <token>
  - [ ] Default Bucket: power_monitoring
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (Test)

---

## –≠—Ç–∞–ø 6: Grafana ‚Äî Dashboard
**–°—Ä–æ–∫: –î–µ–Ω—å 2-3**

### –ü–∞–Ω–µ–ª–∏ (Panels)
- [ ] **Gauge √ó 3** ‚Äî —Ç–µ–∫—É—â–µ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ —Ñ–∞–∑ A, B, C
  - [ ] –¶–≤–µ—Ç–æ–≤—ã–µ –ø–æ—Ä–æ–≥–∏: –∑–µ–ª—ë–Ω—ã–π 198-242, –∂—ë–ª—Ç—ã–π 180-198/242-260, –∫—Ä–∞—Å–Ω—ã–π <180/>260
- [ ] **Stat √ó 3** ‚Äî –º–µ–∂–¥—É—Ñ–∞–∑–Ω—ã–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è AB, BC, CA
- [ ] **Gauge** ‚Äî —á–∞—Å—Ç–æ—Ç–∞ —Å–µ—Ç–∏ (49.5-50.5 –ì—Ü)
- [ ] **Gauge** ‚Äî –ø–µ—Ä–µ–∫–æ—Å —Ñ–∞–∑ (0-10%)
- [ ] **Time Series** ‚Äî –∏—Å—Ç–æ—Ä–∏—è –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–π –∑–∞ 1 —á–∞—Å
- [ ] **Time Series** ‚Äî –∏—Å—Ç–æ—Ä–∏—è —á–∞—Å—Ç–æ—Ç—ã –∑–∞ 1 —á–∞—Å
- [ ] **Alert List** ‚Äî –∞–∫—Ç–∏–≤–Ω—ã–µ –∞–ª–µ—Ä—Ç—ã

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (Variables)
- [ ] `$device` ‚Äî –≤—ã–±–æ—Ä —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (–µ—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ ESP)
- [ ] `$timeRange` ‚Äî –≤—ã–±–æ—Ä –ø–µ—Ä–∏–æ–¥–∞

### –≠–∫—Å–ø–æ—Ä—Ç
- [ ] –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞—à–±–æ—Ä–¥ –≤ JSON
- [ ] –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ `docker/grafana/dashboards/`

---

## –≠—Ç–∞–ø 7: Grafana ‚Äî Alerting
**–°—Ä–æ–∫: –î–µ–Ω—å 3**

### Contact Points
- [ ] **Telegram**:
  - [ ] –°–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather
  - [ ] –ü–æ–ª—É—á–∏—Ç—å Chat ID
  - [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Contact Point
- [ ] **Email** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
  - [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SMTP –≤ grafana.ini

### Alert Rules
- [ ] **Phase Loss** (Critical):
  - [ ] –£—Å–ª–æ–≤–∏–µ: `voltage < 50`
  - [ ] For: 5s
  - [ ] ‚Üí Telegram
- [ ] **Under Voltage** (Warning):
  - [ ] –£—Å–ª–æ–≤–∏–µ: `voltage < 198`
  - [ ] For: 30s
  - [ ] ‚Üí Telegram
- [ ] **Over Voltage** (Warning):
  - [ ] –£—Å–ª–æ–≤–∏–µ: `voltage > 242`
  - [ ] For: 30s
  - [ ] ‚Üí Telegram
- [ ] **Unbalance** (Warning):
  - [ ] –£—Å–ª–æ–≤–∏–µ: `unbalance > 4`
  - [ ] For: 1m
  - [ ] ‚Üí Email

### Notification Policies
- [ ] –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤ –ø–æ device
- [ ] Repeat interval: 1 —á–∞—Å

---

## –≠—Ç–∞–ø 8: –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
**–°—Ä–æ–∫: –î–µ–Ω—å 4**

### –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞
- [ ] –ò–∑–º–µ—Ä–∏—Ç—å —Ä–µ–∞–ª—å–Ω–æ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ –º—É–ª—å—Ç–∏–º–µ—Ç—Ä–æ–º
- [ ] –ü–æ–¥–æ–±—Ä–∞—Ç—å `SENSITIVITY` –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–∞—Ç—á–∏–∫–∞
- [ ] –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –≤ Preferences (NVS)

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –¢–µ—Å—Ç —Ç–æ—á–Ω–æ—Å—Ç–∏ –∏–∑–º–µ—Ä–µ–Ω–∏–π (—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –º—É–ª—å—Ç–∏–º–µ—Ç—Ä–æ–º)
- [ ] –¢–µ—Å—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ WiFi (24 —á–∞—Å–∞)
- [ ] –¢–µ—Å—Ç –∞–ª–µ—Ä—Ç–æ–≤ (–∏–º–∏—Ç–∞—Ü–∏—è –æ–±—Ä—ã–≤–∞ —Ñ–∞–∑—ã)
- [ ] –¢–µ—Å—Ç Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

---

## –≠—Ç–∞–ø 9: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è
**–°—Ä–æ–∫: –î–µ–Ω—å 4-5**

- [ ] –û–±–Ω–æ–≤–∏—Ç—å README.md
- [ ] –°–æ–∑–¥–∞—Ç—å `docs/wiring.md` ‚Äî —Å—Ö–µ–º–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å —Ñ–æ—Ç–æ
- [ ] –°–æ–∑–¥–∞—Ç—å `docs/calibration.md` ‚Äî –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∫–∞–ª–∏–±—Ä–æ–≤–∫–µ
- [ ] –ó–∞–ø–∏—Å–∞—Ç—å —Å–∫—Ä–∏–Ω–∫–∞—Å—Ç –¥–∞—à–±–æ—Ä–¥–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –°–¥–µ–ª–∞—Ç—å release –Ω–∞ GitHub

---

## –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (v2.0)

- [ ] OTA –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—à–∏–≤–∫–∏
- [ ] –ù–µ—Å–∫–æ–ª—å–∫–æ ESP32 —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –Ω–∞ –æ–¥–∏–Ω –¥–∞—à–±–æ—Ä–¥
- [ ] OLED –¥–∏—Å–ø–ª–µ–π –Ω–∞ ESP32
- [ ] –•—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –∞–ª–µ—Ä—Ç–æ–≤ (InfluxDB Annotations)
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ downsampling (InfluxDB Tasks)
- [ ] Mobile-friendly Grafana (Grafana Mobile App)

---

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ú–∏–Ω–∏–º—É–º | –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è |
|-----------|---------|---------------|
| RAM | 1 GB | 2 GB |
| CPU | 1 core | 2 cores |
| Disk | 10 GB | 20 GB SSD |
| OS | Linux (Docker) | Ubuntu 22.04 / Debian 12 |

–ü–æ–¥–æ–π–¥—ë—Ç: Raspberry Pi 4, –ª—é–±–æ–π VPS, NAS —Å Docker.

---

*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 24.12.2024*
