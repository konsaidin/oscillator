# üìã –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞

## –°—Ç–∞—Ç—É—Å: ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

## –§–∏–Ω–∞–ª—å–Ω—ã–π —Å—Ç–µ–∫
- **ESP32-S3** ‚Üí HTTP POST ‚Üí **InfluxDB 2.7** ‚Üí **Grafana 10.x**
- –ë–µ–∑ custom backend ‚Äî Grafana –¥–µ–ª–∞–µ—Ç –≤—Å—ë (–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è + –∞–ª–µ—Ä—Ç—ã + —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)

---

## –≠—Ç–∞–ø 1: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (Docker)
**–°—Ç–∞—Ç—É—Å: ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ**

- [x] –°–æ–∑–¥–∞—Ç—å `docker-compose.yml`:
  - [x] InfluxDB 2.7 (–ø–æ—Ä—Ç 8086)
  - [x] Grafana 10.x (–ø–æ—Ä—Ç 3000)
  - [x] Volumes –¥–ª—è –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
- [x] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å InfluxDB:
  - [x] Organization: `home`
  - [x] Bucket: `power_monitoring`
  - [x] Retention Policy: 30 –¥–Ω–µ–π
  - [x] API Token (—á–µ—Ä–µ–∑ env)
- [x] Grafana provisioning:
  - [x] –ê–≤—Ç–æ–Ω–∞—Å—Ç—Ä–æ–π–∫–∞ datasource InfluxDB
  - [x] –ê–≤—Ç–æ–∏–º–ø–æ—Ä—Ç dashboard

**–§–∞–π–ª—ã:**
- `docker/docker-compose.yml`
- `docker/grafana/provisioning/datasources/influxdb.yml`
- `docker/grafana/provisioning/dashboards/dashboards.yml`
- `docker/grafana/dashboards/power-monitoring.json`

---

## –≠—Ç–∞–ø 2: Firmware ESP32-S3 ‚Äî –ë–∞–∑–æ–≤—ã–π
**–°—Ç–∞—Ç—É—Å: ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ**

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- [x] –°–æ–∑–¥–∞—Ç—å `firmware/` –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
- [x] `platformio.ini` - ESP32-S3-DevKitC-1
- [x] `src/config.h` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è WiFi, InfluxDB, –ø–∏–Ω—ã, –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞

**–§–∞–π–ª—ã:**
- `firmware/platformio.ini`
- `firmware/src/config.h`

---

## –≠—Ç–∞–ø 3: Firmware ‚Äî –°–µ–Ω—Å–æ—Ä—ã –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞
**–°—Ç–∞—Ç—É—Å: ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ**

### VoltageSensor –∫–ª–∞—Å—Å
- [x] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ ADC1 (GPIO 1, 2, 3)
- [x] –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ 12 –±–∏—Ç, –∞—Ç—Ç–µ–Ω—é–∞—Ü–∏—è 11dB
- [x] –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ offset –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- [x] –ú–µ—Ç–æ–¥ `readRMS()` - —Ä–∞—Å—á—ë—Ç –¥–µ–π—Å—Ç–≤—É—é—â–µ–≥–æ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è
- [x] –ú–µ—Ç–æ–¥ `getFrequency()` - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã —á–µ—Ä–µ–∑ Zero-Crossing

### PowerAnalyzer –∫–ª–∞—Å—Å
- [x] –ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Å 3 –¥–∞—Ç—á–∏–∫–æ–≤
- [x] –†–∞—Å—á—ë—Ç –º–µ–∂–¥—É—Ñ–∞–∑–Ω—ã—Ö –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–π (—Ñ–æ—Ä–º—É–ª–∞ —Å —É—á—ë—Ç–æ–º 120¬∞)
- [x] –†–∞—Å—á—ë—Ç –ø–µ—Ä–µ–∫–æ—Å–∞ —Ñ–∞–∑ (%)
- [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä–æ–≥–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (–ø—Ä–æ–±–ª–µ–º—ã)
- [x] –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ Line Protocol —Å—Ç—Ä–æ–∫–∏

**–§–∞–π–ª—ã:**
- `firmware/src/VoltageSensor.h` / `.cpp`
- `firmware/src/PowerAnalyzer.h` / `.cpp`

---

## –≠—Ç–∞–ø 4: Firmware ‚Äî HTTP –∫–ª–∏–µ–Ω—Ç
**–°—Ç–∞—Ç—É—Å: ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ**

### InfluxClient –∫–ª–∞—Å—Å
- [x] HTTP POST –Ω–∞ InfluxDB API v2
- [x] –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ Line Protocol
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- [x] –ú–µ—Ç–æ–¥ `ping()` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- [x] –°—á—ë—Ç—á–∏–∫–∏ —É—Å–ø–µ—à–Ω—ã—Ö/–Ω–µ—É–¥–∞—á–Ω—ã—Ö –æ—Ç–ø—Ä–∞–≤–æ–∫

**–§–∞–π–ª—ã:**
- `firmware/src/InfluxClient.h` / `.cpp`

---

## –≠—Ç–∞–ø 5: Firmware ‚Äî Main
**–°—Ç–∞—Ç—É—Å: ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ**

- [x] –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WiFi —Å retry
- [x] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞—Ç—á–∏–∫–æ–≤ –∏ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞
- [x] –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª: –∏–∑–º–µ—Ä–µ–Ω–∏–µ ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
- [x] LED –∏–Ω–¥–∏–∫–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
- [x] –í—ã–≤–æ–¥ —Å—Ç–∞—Ç—É—Å–∞ –≤ Serial Monitor
- [x] –ê–≤—Ç–æ–ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ WiFi

**–§–∞–π–ª—ã:**
- `firmware/src/main.cpp`

---

## –≠—Ç–∞–ø 6: Grafana Dashboard
**–°—Ç–∞—Ç—É—Å: ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ**

- [x] Gauge –ø–∞–Ω–µ–ª–∏ –¥–ª—è –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–π (A, B, C)
- [x] Gauge –¥–ª—è —á–∞—Å—Ç–æ—Ç—ã –∏ –ø–µ—Ä–µ–∫–æ—Å–∞
- [x] Stat –ø–∞–Ω–µ–ª–∏ –¥–ª—è –ª–∏–Ω–µ–π–Ω—ã—Ö –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–π
- [x] Time Series –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏
- [x] Variable –¥–ª—è –≤—ã–±–æ—Ä–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

**–§–∞–π–ª—ã:**
- `docker/grafana/dashboards/power-monitoring.json`

---

## –≠—Ç–∞–ø 7: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
**–°—Ç–∞—Ç—É—Å: ‚è≥ –û–∂–∏–¥–∞–µ—Ç**

- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å `docker-compose up -d`
- [ ] –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å –∏ –ø—Ä–æ—à–∏—Ç—å ESP32
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ InfluxDB Explore
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å dashboard –≤ Grafana
- [ ] –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –¥–∞—Ç—á–∏–∫–æ–≤ —Å –º—É–ª—å—Ç–∏–º–µ—Ç—Ä–æ–º

---

## –≠—Ç–∞–ø 8: –ê–ª–µ—Ä—Ç—ã Grafana
**–°—Ç–∞—Ç—É—Å: ‚è≥ –û–∂–∏–¥–∞–µ—Ç**

- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Contact Points (Telegram, Email)
- [ ] –°–æ–∑–¥–∞—Ç—å Alert Rules:
  - [ ] Phase Loss (U < 50V)
  - [ ] Under/Over Voltage (¬±10%)
  - [ ] High Unbalance (>4%)
  - [ ] Frequency Drift (>0.5Hz)

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ó–∞–ø—É—Å–∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
```bash
cd docker
docker-compose up -d
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ firmware
```bash
cd firmware
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å src/config.h (WiFi, IP —Å–µ—Ä–≤–µ—Ä–∞)
```

### 3. –ü—Ä–æ—à–∏–≤–∫–∞ ESP32
```bash
pio run -t upload
pio device monitor
```

### 4. –û—Ç–∫—Ä—ã—Ç—å Grafana
- http://localhost:3000 (admin / admin)
- Dashboard "Three-Phase Power Monitor" —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (—Ñ–∏–Ω–∞–ª—å–Ω–∞—è)

```
oscillator/
‚îú‚îÄ‚îÄ README.md                   # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ TODO.md                     # –≠—Ç–æ—Ç —Ñ–∞–π–ª
‚îÇ
‚îú‚îÄ‚îÄ docker/
‚îÇ   ‚îú‚îÄ‚îÄ docker-compose.yml      # InfluxDB + Grafana
‚îÇ   ‚îî‚îÄ‚îÄ grafana/
‚îÇ       ‚îú‚îÄ‚îÄ provisioning/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ datasources/influxdb.yml
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ dashboards/dashboards.yml
‚îÇ       ‚îî‚îÄ‚îÄ dashboards/
‚îÇ           ‚îî‚îÄ‚îÄ power-monitoring.json
‚îÇ
‚îî‚îÄ‚îÄ firmware/
    ‚îú‚îÄ‚îÄ platformio.ini
    ‚îî‚îÄ‚îÄ src/
        ‚îú‚îÄ‚îÄ config.h            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        ‚îú‚îÄ‚îÄ VoltageSensor.h/cpp # –†–∞–±–æ—Ç–∞ —Å ZMPT101B
        ‚îú‚îÄ‚îÄ PowerAnalyzer.h/cpp # –ê–Ω–∞–ª–∏–∑ 3 —Ñ–∞–∑
        ‚îú‚îÄ‚îÄ InfluxClient.h/cpp  # HTTP –∫–ª–∏–µ–Ω—Ç
        ‚îî‚îÄ‚îÄ main.cpp            # –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª
```
